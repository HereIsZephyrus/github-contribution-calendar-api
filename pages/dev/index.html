<!DOCTYPE html>
<html lang="en" class="h-full text-navy bg-steel">
    <head>
        <meta charset="utf-8" />
        <title>GitHub Contribution API</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="description" content="Ryan Christian's GitHub Contribution API" />
        <link rel="shortcut icon" href="/assets/favicon.ico" />
        <style>
            code {
                display: block;
                overflow-x: auto;
                padding: 0.5em;
                color: #ddd;
            }

            .token.number,
            .token.string {
                color: #d14124;
            }
        </style>
        <style></style>
    </head>
    <body class="h-full">
        <div class="flex flex-col h-full">
            <section class="bg-navy">
                <div class="py-12 px-4">
                    <div class="mx-auto text-center">
                        <h1 class="mb-2 text-5xl text-steel font-bold">
                            GitHub Contribution Calendar API
                        </h1>
                        <h2 class="text-steel-dim hover:text-steel-dimmer">
                            <a
                                id="header-link-text"
                                class="break-words underline"
                                href="https://gh-calendar.rschristian.dev/user/rschristian"
                            >
                                https://gh-calendar.rschristian.dev/user/{username}
                            </a>
                        </h2>
                        <a
                            class="
                                mt-8
                                px-4
                                py-2
                                inline-flex
                                rounded-md
                                text-steel
                                border-1 border-solid border-steel
                                bg-white bg-opacity-10
                                hover:text-white
                                hover:bg-white
                                hover:bg-opacity-20
                                hover:border-steel-dimmer
                            "
                            href="https://github.com/rschristian/github-contribution-calendar-api"
                            target="_blank"
                            rel="noreferrer"
                        >
                            Check it out on GitHub
                        </a>
                    </div>
                </div>
            </section>
            <main class="w-full lg:max-w-screen-lg mx-auto px-6 py-12 flex-auto">
                <h1 class="mb-2 text-4xl text-center lg:text-left">Data Structure</h1>
                <p class="text-base lg:text-xl text-justify lg:ml-4 mb-2">
                    Below is an sample of the data that is returned. By default, my own profile data
                    is provided, but feel free to enter your own user name to see the data and the
                    structure that is returned.
                </p>
                <p class="text-base lg:text-xl text-justify lg:ml-4">
                    This API will cache values, meaning counts are only updated once per 24 hours
                    per user.
                </p>
                <div class="my-8 mx-4 flex flex-col md:flex-row md:justify-between">
                    <div class="md:w-2/12 mb-3 pt-0">
                        <label for="usernameInput" class="hidden">Username</label>
                        <input
                            id="usernameInput"
                            class="px-2 py-2 rounded-lg shadow outline-none focus:ring w-full"
                            type="text"
                            placeholder="rschristian"
                        />
                    </div>
                    <pre
                        class="md:w-9/12 h-3/4 lg:h-1/2 px-0 py-0 bg-navy rounded-lg overflow-auto"
                    ><code id="jsonData" class="language-json"></code></pre>
                </div>
            </main>
            <footer class="p-1 bg-navy text-offWhite text-center">
                <span
                    >Â© 2021 Ryan Christian
                    <a
                        class="text-red hover:text-red-hover"
                        href="https://github.com/rschristian"
                        target="_blank"
                        rel="noopener noreferrer"
                        >@rschristian</a
                    ></span
                >
            </footer>
        </div>

        <script src="/prism.js"></script>
        <script type="module">
            getUserData('rschristian');
            async function getUserData(username) {
                try {
                    const response = await (
                        await fetch(`https://gh-calendar.rschristian.dev/user/${username}`)
                    ).json();
                    const jsonElement = document.getElementById('jsonData');
                    jsonElement.innerHTML = JSON.stringify(
                        response.message
                            ? response
                            : {
                                  total: response.total,
                                  contributions: response.contributions.slice(0, 3),
                              },
                        null,
                        2,
                    );
                    Prism.highlightElement(jsonElement);
                } catch (e) {
                    console.log(e);
                }
            }

            document.getElementById('usernameInput').addEventListener('change', (e) => {
                if (e.target.value) {
                    getUserData(e.target.value);
                    setHeaderLink(e.target.value);
                } else {
                    getUserData(undefined);
                    setHeaderLink(undefined);
                }
            });

            const headerLink = document.getElementById('header-link-text');

            function setHeaderLink(username) {
                headerLink.text = headerLink.text.replace(
                    /([^/]+$)/,
                    username ? username : '{username}',
                );
                headerLink.href = headerLink.href.replace(
                    /([^/]+$)/,
                    username ? username : 'undefined',
                );
            }
        </script>
    </body>
</html>
